import ast, re, math
import numpy as np


# def remove_defaultdict_wrappers(s):
#     # 将所有 defaultdict(<class 'dict'>, {...}) 替换成 {...}
#     pattern = r"defaultdict\(<class 'dict'>,\s*({.*?})\)"
#     return re.sub(pattern, r'\1', s)



# raw_str = "{1: defaultdict(<class 'dict'>, {0: {'scale': 1.0, 'coverage': 0.9934865264485033, 'authenticity': 0.99558, 'richness': 0.9995088888888889}, 1: {'scale': 1.0, 'coverage': 0.9941201270821154, 'authenticity': 0.99814, 'richness': 0.9997933333333333}, 2: {'scale': 1.0, 'coverage': 0.9930240353625808, 'authenticity': 0.99316, 'richness': 0.99924}, 3: {'scale': 1.0, 'coverage': 0.9879508810076842, 'authenticity': 0.98522, 'richness': 0.9983577777777778}, 4: {'scale': 1.0, 'coverage': 0.9939738901095597, 'authenticity': 0.99012, 'richness': 0.9989022222222221}, 5: {'scale': 1.0, 'coverage': 0.991530608556269, 'authenticity': 0.9893, 'richness': 0.9988111111111111}, 6: {'scale': 1.0, 'coverage': 0.9935872314793504, 'authenticity': 0.9961, 'richness': 0.9995666666666667}, 7: {'scale': 1.0, 'coverage': 0.9945641072509884, 'authenticity': 0.9943, 'richness': 0.9993666666666667}, 8: {'scale': 1.0, 'coverage': 0.994723285117612, 'authenticity': 0.99678, 'richness': 0.9996422222222222}, 9: {'scale': 1.0, 'coverage': 0.9910966158518587, 'authenticity': 0.99794, 'richness': 0.999771111111111}}), 2: defaultdict(<class 'dict'>, {0: {'scale': 0.5, 'coverage': 0.9906186546193894, 'authenticity': 0.9966600000000001, 'richness': 0.9996288888888889}, 1: {'scale': 0.5, 'coverage': 0.9901833727568514, 'authenticity': 0.9984, 'richness': 0.9998222222222222}, 2: {'scale': 0.5, 'coverage': 0.9905060763919259, 'authenticity': 0.99434, 'richness': 0.9993711111111111}, 3: {'scale': 0.5, 'coverage': 0.9841205894083542, 'authenticity': 0.98844, 'richness': 0.9987155555555556}, 4: {'scale': 0.5, 'coverage': 0.9915008727520954, 'authenticity': 0.99178, 'richness': 0.9990866666666667}, 5: {'scale': 0.5, 'coverage': 0.9883756253696048, 'authenticity': 0.99176, 'richness': 0.9990844444444444}, 6: {'scale': 0.5, 'coverage': 0.9929670965980048, 'authenticity': 0.99678, 'richness': 0.9996422222222222}, 7: {'scale': 0.5, 'coverage': 0.9910689908853328, 'authenticity': 0.99524, 'richness': 0.9994711111111111}, 8: {'scale': 0.5, 'coverage': 0.9924906339133506, 'authenticity': 0.99734, 'richness': 0.9997044444444445}, 9: {'scale': 0.5, 'coverage': 0.988903586173899, 'authenticity': 0.99838, 'richness': 0.9998199999999999}}), 5: defaultdict(<class 'dict'>, {0: {'scale': 0.2, 'coverage': 0.9833236722100029, 'authenticity': 0.99626, 'richness': 0.9995844444444444}, 1: {'scale': 0.2, 'coverage': 0.9834753132701681, 'authenticity': 0.9980800000000001, 'richness': 0.9997866666666667}, 2: {'scale': 0.2, 'coverage': 0.9833354704774978, 'authenticity': 0.99498, 'richness': 0.9994422222222223}, 3: {'scale': 0.2, 'coverage': 0.979289005325905, 'authenticity': 0.99074, 'richness': 0.9989711111111111}, 4: {'scale': 0.2, 'coverage': 0.9850044020606292, 'authenticity': 0.9919, 'richness': 0.9991}, 5: {'scale': 0.2, 'coverage': 0.9817400310200363, 'authenticity': 0.9926600000000001, 'richness': 0.9991844444444447}, 6: {'scale': 0.2, 'coverage': 0.985523330317044, 'authenticity': 0.99698, 'richness': 0.9996644444444444}, 7: {'scale': 0.2, 'coverage': 0.9820037770771896, 'authenticity': 0.9955, 'richness': 0.9994999999999999}, 8: {'scale': 0.2, 'coverage': 0.984960107422998, 'authenticity': 0.9971399999999999, 'richness': 0.9996822222222222}, 9: {'scale': 0.2, 'coverage': 0.9830596471837192, 'authenticity': 0.99764, 'richness': 0.9997377777777778}}), 10: defaultdict(<class 'dict'>, {0: {'scale': 0.1, 'coverage': 0.9730044255714579, 'authenticity': 0.9954000000000001, 'richness': 0.9994888888888889}, 1: {'scale': 0.1, 'coverage': 0.9695750811934218, 'authenticity': 0.99752, 'richness': 0.9997244444444446}, 2: {'scale': 0.1, 'coverage': 0.9733481065310654, 'authenticity': 0.9938799999999999, 'richness': 0.99932}, 3: {'scale': 0.1, 'coverage': 0.9665538907766031, 'authenticity': 0.99042, 'richness': 0.9989355555555555}, 4: {'scale': 0.1, 'coverage': 0.9745880189648023, 'authenticity': 0.99214, 'richness': 0.9991266666666668}, 5: {'scale': 0.1, 'coverage': 0.9702056130978068, 'authenticity': 0.9930199999999999, 'richness': 0.9992244444444444}, 6: {'scale': 0.1, 'coverage': 0.9718564063191841, 'authenticity': 0.99562, 'richness': 0.9995133333333334}, 7: {'scale': 0.1, 'coverage': 0.9687462286671777, 'authenticity': 0.9953799999999999, 'richness': 0.9994866666666666}, 8: {'scale': 0.1, 'coverage': 0.9738423304576134, 'authenticity': 0.9962799999999999, 'richness': 0.9995866666666668}, 9: {'scale': 0.1, 'coverage': 0.9729380854075982, 'authenticity': 0.9975000000000002, 'richness': 0.9997222222222224}}), 15: defaultdict(<class 'dict'>, {0: {'scale': 0.06666666666666667, 'coverage': 0.9605370873437563, 'authenticity': 0.9953353353353355, 'richness': 0.9994817039261482}, 1: {'scale': 0.06666666666666667, 'coverage': 0.9563670613110745, 'authenticity': 0.9972172172172172, 'richness': 0.9996908019130243}, 2: {'scale': 0.06666666666666667, 'coverage': 0.9577395512411313, 'authenticity': 0.9932932932932934, 'richness': 0.9992548103659212}, 3: {'scale': 0.06666666666666667, 'coverage': 0.9526459733205636, 'authenticity': 0.9895095095095094, 'richness': 0.9988343899455009}, 4: {'scale': 0.06666666666666667, 'coverage': 0.958580357137863, 'authenticity': 0.9915315315315316, 'richness': 0.999059059059059}, 5: {'scale': 0.06666666666666667, 'coverage': 0.9577323651660052, 'authenticity': 0.9932932932932933, 'richness': 0.9992548103659215}, 6: {'scale': 0.06666666666666667, 'coverage': 0.9593294139741059, 'authenticity': 0.9953953953953952, 'richness': 0.9994883772661551}, 7: {'scale': 0.06666666666666667, 'coverage': 0.9581329442981776, 'authenticity': 0.9950550550550553, 'richness': 0.9994505616727838}, 8: {'scale': 0.06666666666666667, 'coverage': 0.962636196452538, 'authenticity': 0.9964564564564565, 'richness': 0.9996062729396062}, 9: {'scale': 0.06666666666666667, 'coverage': 0.9592008739636361, 'authenticity': 0.9970170170170171, 'richness': 0.9996685574463352}}), 20: defaultdict(<class 'dict'>, {0: {'scale': 0.05000000000000001, 'coverage': 0.9463068224946877, 'authenticity': 0.9943000000000002, 'richness': 0.9993666666666667}, 1: {'scale': 0.05000000000000001, 'coverage': 0.9425836540623326, 'authenticity': 0.9972200000000001, 'richness': 0.9996911111111112}, 2: {'scale': 0.05000000000000001, 'coverage': 0.9430914466540224, 'authenticity': 0.9927800000000001, 'richness': 0.9991977777777776}, 3: {'scale': 0.05000000000000001, 'coverage': 0.9382975654283093, 'authenticity': 0.9894000000000001, 'richness': 0.9988222222222223}, 4: {'scale': 0.05000000000000001, 'coverage': 0.947151124428258, 'authenticity': 0.9908999999999999, 'richness': 0.9989888888888888}, 5: {'scale': 0.05000000000000001, 'coverage': 0.9479601354865602, 'authenticity': 0.9930600000000002, 'richness': 0.9992288888888888}, 6: {'scale': 0.05000000000000001, 'coverage': 0.9467273191323395, 'authenticity': 0.9950600000000002, 'richness': 0.9994511111111111}, 7: {'scale': 0.05000000000000001, 'coverage': 0.9429611444412578, 'authenticity': 0.9946200000000001, 'richness': 0.9994022222222222}, 8: {'scale': 0.05000000000000001, 'coverage': 0.9516128963325711, 'authenticity': 0.9958600000000001, 'richness': 0.9995400000000002}, 9: {'scale': 0.05000000000000001, 'coverage': 0.944275987218132, 'authenticity': 0.9967599999999999, 'richness': 0.9996400000000001}}), 30: defaultdict(<class 'dict'>, {0: {'scale': 0.03333333333333333, 'coverage': 0.919679411868525, 'authenticity': 0.9943172690763051, 'richness': 0.9993685854529227}, 1: {'scale': 0.03333333333333333, 'coverage': 0.9161067268125213, 'authenticity': 0.9970682730923693, 'richness': 0.9996742525658185}, 2: {'scale': 0.03333333333333333, 'coverage': 0.9164147995050516, 'authenticity': 0.9931124497991968, 'richness': 0.9992347166443553}, 3: {'scale': 0.03333333333333333, 'coverage': 0.915280337581943, 'authenticity': 0.9900401606425703, 'richness': 0.9988933511825078}, 4: {'scale': 0.03333333333333333, 'coverage': 0.9206364439548836, 'authenticity': 0.9910441767068273, 'richness': 0.9990049085229809}, 5: {'scale': 0.03333333333333333, 'coverage': 0.9144096649586982, 'authenticity': 0.9935742971887548, 'richness': 0.9992860330209729}, 6: {'scale': 0.03333333333333333, 'coverage': 0.9178796763169295, 'authenticity': 0.9956224899598392, 'richness': 0.9995136099955376}, 7: {'scale': 0.03333333333333333, 'coverage': 0.9110983661887941, 'authenticity': 0.9943975903614458, 'richness': 0.9993775100401606}, 8: {'scale': 0.03333333333333333, 'coverage': 0.9229544456895183, 'authenticity': 0.9961445783132528, 'richness': 0.9995716198125836}, 9: {'scale': 0.03333333333333333, 'coverage': 0.9198604768245227, 'authenticity': 0.9967269076305222, 'richness': 0.9996363230700582}})}"

# clean_str = remove_defaultdict_wrappers(raw_str)
# parsed = ast.literal_eval(clean_str)

# for task in parsed[1]:
#     print(parsed[1][task])


# coves = [parsed[1][task]["coverage"] for task in parsed[1]]
# auths = [parsed[1][task]["authenticity"] for task in parsed[1]]
# richs = [parsed[1][task]["richness"] for task in parsed[1]]

# cove = np.mean(coves)
# auth = math.exp(sum(math.log(x) for x in auths) / len(auths))
# rich = math.exp(sum(math.log(x) for x in richs) / len(richs))

# print(cove, auth, rich)


def count_h(s, c, a, r):
    r, delta, err_gen, err_emp = s, 1-c, 1-a, 1-r
    h = delta * np.exp(2 * r * (err_gen - err_emp) ** 2) 

    return h


h = count_h(1, 0.99, 0.99, 0.999)
print(h)