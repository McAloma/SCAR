import numpy as np

def format_result_string(res, total_size):
    import numpy as np

    # 转换为 numpy 数组以便处理
    res = np.array(res)

    # 平均值和变化范围（区间最大值 - 最小值）
    means = np.mean(res, axis=0)
    ranges = np.max(res, axis=0) - np.min(res, axis=0)

    # 分别提取每个字段
    total_acc = means[0]
    extend_size = means[1]
    foundation_size = means[2]
    primary_acc = means[3]
    foundation_extend_acc = means[4]
    random_extend_acc = means[5]
    avg_extend_acc = means[6]

    # 计算前四个指标
    ratio_1 = min(1, total_size / foundation_size)
    ratio_2 = (extend_size - total_size * 0.6) / (total_size - total_size * 0.6)
    ratio_3 = min(1, foundation_size / total_size)

    # 构造字符串
    result_str = (
        f"& {ratio_1:.4f} "
        f"& {ratio_2:.4f} "
        f"& {total_acc:.4f} "
        f"& {ratio_3:.4f} "
        f"& ${extend_size / 1000:.2f}_{{\\pm{ranges[1] / 1000:.2f}}}k$ "
        f"& ${foundation_size / 1000:.2f}_{{\\pm{ranges[2] / 1000:.2f}}}k$ "
        f"& ${primary_acc * 100:.2f}_{{\\pm{ranges[3] * 100:.2f}}}$ "
        f"& ${foundation_extend_acc * 100:.2f}_{{\\pm{ranges[4] * 100:.2f}}}$ "
        f"& ${random_extend_acc * 100:.2f}_{{\\pm{ranges[5] * 100:.2f}}}$ "
        f"& ${avg_extend_acc * 100:.2f}_{{\\pm{ranges[6] * 100:.2f}}}$ "
        f"\\\\"
    )

    return result_str



if __name__ == "__main__":
    # CIFAR 10
    print("\multirow{9}{*}{\\rotatebox{90}{Image}}")
    print("    & \multirow{3}{*}{CIFAR-10}")
    class_10_res = [
        [0.9152, 48936, 90037.7640910375, 0.9105, 0.9153, 0.915, 0.9161],
        [0.9151, 49010, 89898.38036258402, 0.9104, 0.9161, 0.9162, 0.9158],
        [0.9159, 48955, 89831.52133468608, 0.9109, 0.9148, 0.9134, 0.9144],
    ]
    print("                & ResNet50\cite{resnet}", format_result_string(class_10_res, 50000))
    
    class_10_vit = [
        [0.9627, 48142, 96547.73815368443, 0.9623, 0.9632, 0.9629, 0.9628],
        [0.9627, 48094, 96597.95496479256, 0.9623, 0.9633, 0.9631, 0.9628],
        [0.9628, 48125, 96581.5627418755, 0.9622, 0.9626, 0.9628, 0.9634],
    ]
    print("        &       & ViT-B/16\cite{vit}   ", format_result_string(class_10_vit, 50000))

    class_10_dino = [
        [0.981, 49446, 93075.0578640456, 0.9817, 0.9827, 0.9824, 0.9831],
        [0.9827, 49485, 93387.83194962222, 0.9817, 0.9827, 0.9815, 0.9815],
        [0.9816, 49373, 93747.31830828964, 0.982, 0.982, 0.9818, 0.9826],
    ]
    print("        &       & DINO-v2\cite{dino}   ", format_result_string(class_10_dino, 50000))
    print("\\cline{2-13}")

    # CIFAR 100
    print("    & \multirow{3}{*}{CIFAR-100}")
    class_100_res = [
        [0.9423, 48659, 294344.04419946676, 0.8565, 0.9374, 0.9377, 0.9363],
        [0.9425, 48640, 294394.11846491863, 0.8566, 0.9373, 0.9361, 0.9365],
        [0.9425, 48733, 294672.83858126524, 0.8566, 0.9381, 0.9379, 0.9378],
    ]
    print("                & ResNet50\cite{resnet}", format_result_string(class_100_res, 50000))
    
    class_100_vit = [
        [0.964, 49051, 293894.45328016946, 0.9185, 0.9609, 0.9618, 0.9623],
        [0.9641, 49254, 293714.63746483094, 0.9187, 0.9626, 0.9627, 0.9623],
        [0.9639, 49146, 293720.60104503855, 0.9186, 0.9623, 0.9623, 0.9622],
    ]
    print("        &       & ViT-B/16\cite{vit}   ", format_result_string(class_100_vit, 50000))

    class_100_dino = [
        [0.981, 49307, 294454.3487045991, 0.9448, 0.9794, 0.9795, 0.9794],
        [0.9807, 49434, 294608.6274548029, 0.9454, 0.9794, 0.9794, 0.9793],
        [0.9809, 49290, 294461.43853211903, 0.9455, 0.9796, 0.9794, 0.979],
    ]
    print("        &       & DINO-v2\cite{dino}   ", format_result_string(class_100_dino, 50000))
    print("\\cline{2-13}")

    # ImageNet
    print("    & \multirow{3}{*}{ImageNet-1k}")
    class_1000_res = [
        [0.7562, 1020260, 530631.837545, 0.759, 0.7582, 0.7569, 0.7579],
        [0.7559, 1030808, 526109.546903, 0.7595, 0.7565, 0.7566, 0.7567],
        [0.7563, 1031733, 529823.78977, 0.7608, 0.7574, 0.7566, 0.7585],
    ]
    print("                & ResNet50\cite{resnet}", format_result_string(class_1000_res, 1281167))
    
    class_1000_vit = [
        [0.7698, 1051218, 476517.430357, 0.7626, 0.7664, 0.7664, 0.7681],
        [0.7702, 1043155, 476224.66403, 0.7639, 0.7671, 0.7664, 0.7666],
        [0.7704, 1042493, 478158.008221, 0.7636, 0.7661, 0.7659, 0.7668],
    ]
    print("        &       & ViT-B/16\cite{vit}   ", format_result_string(class_1000_vit, 1281167))

    class_1000_dino = [
        [0.7741, 1044336, 473076.672137, 0.7685, 0.7714, 0.7724, 0.7694],
        [0.7749, 1044207, 472565.950913, 0.7704, 0.7717, 0.7675, 0.7707],
        [0.7751, 1043400, 472694.722316, 0.7691, 0.77, 0.7711, 0.771],
    ]
    print("        &       & DINO-v2\cite{dino}   ", format_result_string(class_1000_dino, 1281167))
    print("\\hline")
    print("\n")

    # AgNews
    print("\multirow{9}{*}{\\rotatebox{90}{Text}}")
    print("    & \multirow{3}{*}{AG-News}")
    class_4_bert = [
        [0.9032, 119771, 66207.76130534713, 0.903, 0.9032, 0.9032, 0.9043],
        [0.902, 119606, 64341.96434427559, 0.9009, 0.9026, 0.9033, 0.9028],
        [0.9017, 119054, 67206.95976287451, 0.9014, 0.8999, 0.9028, 0.9001],
    ]
    print("                & BERT\cite{bert}       ", format_result_string(class_4_bert, 120000))
    class_4_roberta = [
        [0.9058, 117808, 61256.16055463385, 0.9021, 0.9054, 0.9046, 0.9066],
        [0.9049, 117099, 49988.26643006613, 0.9024, 0.9036, 0.9049, 0.9018],
        [0.9053, 114783, 60997.24918563843, 0.903, 0.9033, 0.905, 0.907],
    ]
    print("        &       & RoBERTa\cite{RoBERTa} ", format_result_string(class_4_roberta, 120000))
    class_4_gpt2 = [
        [0.9146, 116502, 71011.03912774625, 0.9136, 0.9142, 0.9147, 0.9155],
        [0.9145, 119865, 71515.80954821428, 0.9138, 0.9138, 0.9145, 0.9164],
        [0.9149, 119161, 71192.73425814247, 0.9136, 0.9157, 0.9145, 0.9151],
    ]
    print("        &       & GPT2\cite{gpt}        ", format_result_string(class_4_gpt2, 120000))
    print("\\cline{2-13}")

    # DBPedia
    print("    & \multirow{3}{*}{\makecell{DBPedia\\\\Ontology}}")
    class_14_bert = [
        [0.9898, 481339, 137566.342705, 0.9901, 0.9896, 0.9898, 0.99],
        [0.9895, 470370, 137378.573887, 0.9895, 0.9898, 0.99, 0.9901],
        [0.9901, 473660, 137476.878144, 0.9895, 0.9897, 0.9901, 0.9895],
    ]
    print("                & BERT\cite{bert}       ", format_result_string(class_14_bert, 560000))
    
    class_14_roberta = [
        [0.9859, 461804, 158300.33783, 0.9852, 0.9859, 0.9856, 0.9855],
        [0.9861, 461103, 164240.028245, 0.9853, 0.9857, 0.9859, 0.9854],
        [0.9857, 465534, 152941.796043, 0.9851, 0.9858, 0.9859, 0.9857],
    ]
    print("        &       & RoBERTa\cite{RoBERTa} ", format_result_string(class_14_roberta, 560000))

    class_14_gpt2 = [
        [0.9841, 468645, 165249.416757, 0.9823, 0.9834, 0.9832, 0.9841],
        [0.9836, 466809, 159383.257696, 0.982, 0.9826, 0.9835, 0.9829],
        [0.9841, 464894, 158819.153176, 0.9828, 0.9838, 0.9834, 0.9835],
    ]
    print("        &       & GPT2\cite{gpt}        ", format_result_string(class_14_gpt2, 560000))
    print("\\cline{2-13}")

    # Wikipedia
    print("    & \multirow{3}{*}{Wikipedia}")
    class_100_bert = [
        [0.4075, 584610, 359613.5735579998, 0.4039, 0.4046, 0.405, 0.4041],
        [0.4044, 584653, 359453.66314402176, 0.669, 0.4031, 0.4033, 0.4055],
        [0.4034, 584614, 334193.7437684523, 0.4061, 0.405, 0.4048, 0.4038],
    ]
    print("                & BERT\cite{bert}       ", format_result_string(class_100_bert, 945242))
    class_100_roberta = [
        [0.044, 588331, 359964.91992675274, 0.403, 0.403, 0.0494, 0.403],
        [0.044, 588383, 360112.7929233759, 0.403, 0.403, 0.403, 0.403],
        [0.403, 588428, 360112.2413802835, 0.0456, 0.403, 0.0563, 0.403],
    ]
    print("        &       & RoBERTa\cite{RoBERTa} ", format_result_string(class_100_roberta, 945242))
    class_100_gpt2 = [
        [0.3894, 588213, 356986.468984289, 0.3857, 0.3759, 0.3749, 0.3766],
        [0.3759, 588649, 356055.0628326447, 0.4259, 0.4346, 0.3782, 0.3826],
        [0.3886, 588439, 356769.2900389706, 0.3845, 0.4132, 0.3816, 0.3726],
    ]
    print("        &       & GPT2\cite{gpt}        ", format_result_string(class_100_gpt2, 945242))
    print("\\hline")
    print("\n")



    # Flickr30k
    print("\multirow{12}{*}{\\rotatebox{90}{Image-Text}} ")
    print("        & \multirow{3}{*}{\makecell{Flickr30k\\\\(Text)}}")
    flickr_clip_text = [
        [0.2911, 20385, 124896.12243721851, 0.2136, 0.4138, 0.2044, 0.3361],
        [0.3843, 20073, 123237.65375590487, 0.2291, 0.3018, 0.326, 0.3148],
        [0.2887, 20183, 116586.53280826975, 0.297, 0.5338, 0.3913, 0.4933],
    ]
    print("                & CLIP\cite{clip}        ", format_result_string(flickr_clip_text, 24811))
    flickr_coca_text = [
        [0.4677, 20237, 116780.5222299308, 0.3674, 0.58, 0.4767, 0.3576],
        [0.4709, 20207, 116798.43685003744, 0.4691, 0.5825, 0.1744, 0.5393],
        [0.4653, 20259, 119426.20611928651, 0.3124, 0.5733, 0.4682, 0.5443],
    ]
    print("        &       & CoCa\cite{coca}        ", format_result_string(flickr_coca_text, 24811))
    flickr_siglip_text = [
        [0.2307, 20806, 126063.08581114949, 0.2384, 0.1843, 0.1762, 0.1643],
        [0.1625, 20645, 126737.33648265661, 0.2062, 0.242, 0.2389, 0.2438],
        [0.2231, 20809, 125584.31682244183, 0.1991, 0.2321, 0.2417, 0.3095],
    ]
    print("        &       & SigLIP\cite{siglip}    ", format_result_string(flickr_siglip_text, 24811))    
    print("\\cline{2-13}")
    

    print("        & \multirow{3}{*}{\makecell{Flickr30k\\\\(Image)}}")
    flickr_clip_image = [
        [0.4046, 19960, 113150.14132366439, 0.3987, 0.4628, 0.4137, 0.4319],
        [0.3584, 19992, 114018.95610298094, 0.3996, 0.4559, 0.4042, 0.4374],
        [0.4038, 19953, 113135.23624952654, 0.4096, 0.4603, 0.4069, 0.4303],
    ]
    print("                & CLIP\cite{clip}        ",  format_result_string(flickr_clip_image, 24811))
    flickr_coca_image = [
        [0.5028, 18953, 120054.83372254227, 0.5002, 0.5165, 0.5001, 0.5133],
        [0.5035, 18940, 119643.42638349406, 0.5015, 0.5167, 0.4972, 0.508],
        [0.5035, 18922, 119911.55437637621, 0.4999, 0.513, 0.5017, 0.5096],
    ]
    print("        &       & CoCa\cite{coca}        ", format_result_string(flickr_coca_image, 24811))
    flickr_siglip_image = [
        [0.1788, 16174, 128616.96344609605, 0.2958, 0.2971, 0.297, 0.296],
        [0.2961, 16171, 128457.60751850538, 0.297, 0.297, 0.2961, 0.1783],
        [0.2936, 16178, 128126.91119078913, 0.2952, 0.2965, 0.2971, 0.2971],
    ]
    print("        &       & SigLIP\cite{siglip}    ", format_result_string(flickr_siglip_image, 24811))
    print("\\cline{2-13}")


    # COCO Caption
    print("        & \multirow{3}{*}{\makecell{COCO Captions\\\\(Text)}}")
    coco_clip_text = [
        [0.6029, 58380, 256786.32486557055, 0.5972, 0.6267, 0.5869, 0.6211],
        [0.5914, 58400, 258673.500792538, 0.5937, 0.6169, 0.5883, 0.617],
        [0.5847, 58379, 255989.91815435086, 0.5976, 0.6245, 0.5927, 0.6155],
    ]
    print("                & CLIP\cite{clip}        ",  format_result_string(coco_clip_text, 82783))
    coco_coca_text = [
        [0.5985, 60476, 256352.37489641883, 0.6132, 0.6506, 0.6064, 0.6466],
        [0.5955, 60427, 256401.43312580427, 0.5946, 0.6435, 0.5868, 0.6465],
        [0.6065, 60524, 256985.3758712338, 0.5956, 0.6522, 0.6006, 0.6326],
    ]
    print("        &       & CoCa\cite{coca}        ", format_result_string(coco_coca_text, 82783))
    coco_siglip_text = [
        [0.1399, 63789, 278861.33082897036, 0.153, 0.1847, 0.1528, 0.1759],
        [0.1382, 63736, 323191.482040552, 0.1579, 0.1852, 0.1203, 0.1281],
        [0.1512, 63715, 279293.81426754047, 0.1219, 0.1813, 0.1376, 0.1708],
    ]
    print("        &       & SigLIP\cite{siglip}    ", format_result_string(coco_siglip_text, 82783))
    print("\\cline{2-13}")

    print("        & \multirow{3}{*}{\makecell{COCO Captions\\\\(Image)}}")
    coco_clip_image = [
        [0.6227, 58188, 254507.55208876418, 0.6167, 0.665, 0.6252, 0.6533],
        [0.6149, 58192, 254999.76169424967, 0.6235, 0.6533, 0.6289, 0.6585],
        [0.6307, 58191, 254870.74758121587, 0.6224, 0.6627, 0.6288, 0.6607],
    ]
    print("                & CLIP\cite{clip}        ",  format_result_string(coco_clip_image, 82783))
    coco_coca_image = [
        [0.6117, 58309, 259882.2132178478, 0.6078, 0.6266, 0.6111, 0.6256],
        [0.6064, 58327, 260734.9114975277, 0.6143, 0.6247, 0.613, 0.6298],
        [0.6118, 58305, 261292.82680782594, 0.6023, 0.6279, 0.6115, 0.6263],
    ]
    print("        &       & CoCa\cite{coca}        ", format_result_string(coco_coca_image, 82783))
    coco_siglip_image = [
        [0.2017, 53140, 284041.66370568256, 0.2151, 0.2194, 0.2127, 0.214],
        [0.2228, 53132, 283774.2048076732, 0.2098, 0.2079, 0.2095, 0.1831],
        [0.2058, 53146, 283720.21674437466, 0.2123, 0.2124, 0.1799, 0.2429],
    ]
    print("        &       & SigLIP\cite{siglip}    ", format_result_string(coco_siglip_image, 82783))
    print("\\hline")
    print("\n")



    # MSR VTT
    print("\multirow{4}{*}{\\rotatebox{90}{Video-Text}} ")
    print("        & \multirow{2}{*}{\makecell{MSR-VTT (Text)}}")
    msrvtt_vc_text = [
        [0.403, 6532, 74715.2391328085, 0.455, 0.455, 0.403, 0.403],
        [0.455, 6574, 74999.97238429805, 0.403, 0.403, 0.455, 0.403],
        [0.455, 6570, 74591.76944851674, 0.142, 0.403, 0.403, 0.455],
    ]
    print("                & VideoCLIP\cite{videoclip} ",  format_result_string(msrvtt_vc_text, 9000))
    msrvtt_xc_text = [
        [0.283, 7294, 72660.88346404694, 0.453, 0.419, 0.283, 0.306],
        [0.283, 7268, 72693.96882526131, 0.443, 0.453, 0.283, 0.345],
        [0.265, 7311, 72760.75088696303, 0.453, 0.453, 0.453, 0.453],
    ]
    print("        &       & X-CLIP\cite{xclip}     ", format_result_string(msrvtt_xc_text, 9000))
    print("\\cline{2-13}")

    print("        & \multirow{2}{*}{\makecell{MSR-VTT (Video)}}")
    msrvtt_vc_video = [
        [0.32, 6340, 74596.29836106756, 0.279, 0.269, 0.255, 0.276],
        [0.322, 6336, 74600.0011428684, 0.244, 0.321, 0.263, 0.319],
        [0.24, 6343, 74606.13720306139, 0.254, 0.348, 0.355, 0.286],
    ]
    print("                & VideoCLIP\cite{videoclip} ",  format_result_string(msrvtt_vc_video, 9000))
    msrvtt_xc_video = [
        [0.397, 7034, 72649.1960970279, 0.389, 0.441, 0.408, 0.364],
        [0.412, 7043, 72671.49972476979, 0.459, 0.413, 0.45, 0.395],
        [0.42, 7054, 72645.55179728588, 0.462, 0.385, 0.435, 0.399],
    ]
    print("        &       & X-CLIP\cite{xclip}     ", format_result_string(msrvtt_xc_video, 9000))
    print("\\hline")
    print("\n")


    # AudioCaps
    print("\multirow{4}{*}{\\rotatebox{90}{Audio-Text}} ")
    print("        & \multirow{2}{*}{\makecell{AudioCaps (Text)}}")
    AudioCaps_clap_text = [
        [0.4089, 40147, 57837.045815287565, 0.4116, 0.4053, 0.4067, 0.4085],
        [0.4049, 40292, 56091.86606478559, 0.4089, 0.4026, 0.4148, 0.4094],
        [0.4049, 39966, 55388.338699472566, 0.4112, 0.4062, 0.4076, 0.4103],
    ]
    print("                & CLAP\cite{clap}         ",  format_result_string(AudioCaps_clap_text, 45178))
    AudioCaps_pengi_text = [
        [0.0778, 36077, 69617.95992766634, 0.076, 0.0729, 0.0765, 0.0747],
        [0.0751, 36040, 55084.11905881815, 0.0778, 0.0715, 0.076, 0.0769],
        [0.0747, 36813, 72175.91511602829, 0.0778, 0.0729, 0.0783, 0.0729],
    ]
    print("        &       & Pengi\cite{pengi}       ", format_result_string(AudioCaps_pengi_text, 45178))
    print("\\cline{2-13}")

    print("        & \multirow{2}{*}{\makecell{AudioCaps (Audio)}}")
    AudioCaps_clap_audio = [
        [0.2609, 40475, 50930.31913569926, 0.2623, 0.2627, 0.2681, 0.26],
        [0.2578, 40419, 50934.73952369976, 0.2668, 0.2636, 0.2609, 0.2596],
        [0.2591, 40868, 50786.063380810825, 0.2677, 0.2533, 0.2591, 0.2578],
    ]
    print("                & CLAP\cite{clap}         ",  format_result_string(AudioCaps_clap_audio, 45178))
    AudioCaps_pengi_audio = [
        [0.1206, 35859, 56423.5447198529, 0.1125, 0.1102, 0.1138, 0.1098],
        [0.1156, 36522, 56331.11361859442, 0.1188, 0.1107, 0.1296, 0.1053],
        [0.1188, 36657, 56379.097074869314, 0.1309, 0.1102, 0.1138, 0.1098],
    ]
    print("        &       & Pengi\cite{pengi}       ", format_result_string(AudioCaps_pengi_audio, 45178))
    print("\\hline")
    print("\n")


    # TEST：CONCH
    hanlin_image20 = [
        [0.2754, 1949450, 1204874.4112099824, 0.2746, 0.2819, 0.29, 0.2548],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_image20, 3199983))

    hanlin_image30 = [
        [0.2405, 1975064, 1684956.2900355794, 0.2604, 0.2338, 0.2522, 0.2473],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_image30, 3199983))

    hanlin_image40 = [
        [0.2332, 1928740, 2275920.110318825, 0.2263, 0.2478, 0.232, 0.2325],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_image40, 3199983))

    hanlin_image50 = [
        [0.2434, 1924638, 2885009.3251153864, 0.2312, 0.2255, 0.2406, 0.2263],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_image50, 3199983))

    hanlin_text20 = [
        [0.2611, 82501, 1177483.3280753577, 0.2343, 0.2357, 0.217, 0.2766],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_text20, 136403))

    hanlin_text30 = [
        [0.3339, 82015, 1891090.381625905, 0.3679, 0.3719, 0.2255, 0.2908],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_text30, 136403))

    hanlin_text40 = [
        [0.1575, 82003, 251356.11060053157, 0.1888, 0.1682, 0.161, 0.1644],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_text40, 136403))

    hanlin_text50 = [
        [0.1329, 81868, 3127268.607229212, 0.1582, 0.127, 0.1314, 0.125],
    ]
    print("CONCH & Hanlin", format_result_string(hanlin_text50, 136403))